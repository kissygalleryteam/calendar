/*! calendar - v1.1 - 2013-05-06 11:21:01 AM
* Copyright (c) 2013 昂天; Licensed  */
KISSY.add("gallery/calendar/1.1/index",function(e,t,s){function i(){i.superclass.constructor.apply(this,arguments),this.initializer()}var a=t.all,n=e.each,r=e.substitute,o=e.UA.ie,d=/\d+/g,h=/^((19|2[01])\d{2})-(0?[1-9]|1[012])-(0?[1-9]|[12]\d|3[01])$/,l=a(document.body),u=a(window),g=a(document);return e.TripCalendar=e.extend(i,s,{initializer:function(){this._hide=!0,this._setUniqueTag().renderUI(),this._minDateCache=this.get("minDate"),this._clickoutside=function(t){var s=e.one(t.target);s.hasClass(this._triggerNodeClassName)||s.hasClass(this._triggerNodeIcon)||s.parent("#"+this._calendarId)||!this._hide||this.hide()},this.get("container")||this.hide()},renderUI:function(){var t=e.one(this.get("container"));(t||l).append(this._initCalendarHTML(this.get("date"))),this.boundingBox=e.one("#"+this._calendarId).css("position",t?"relative":"absolute"),this._dateBox=this.boundingBox.one(".date-box"),this._contentBox=this.boundingBox.one(".content-box"),this._messageBox=this.boundingBox.one(".message-box"),t||(this._inputWrap()._setDefaultValue(),this.boundingBox.css("top","-9999px")),this.set("boundingBox",this.boundingBox),this.bindUI()._fixSelectMask()._setWidth()._setBtnStates()._setDateStyle()},bindUI:function(){return this.on("afterMessageChange",this._setMessage),this.boundingBox.delegate("click","."+this._delegateClickClassName,this._DELEGATE.click,this),this.boundingBox.delegate("change","."+this._delegateChangeClassName,this._DELEGATE.change,this),this.get("container")?this:(this.boundingBox.delegate("mouseenter mouseleave","a",this._DELEGATE.mouse,this),g.delegate("focusin","."+this._triggerNodeClassName,this._DELEGATE.focusin,this),g.delegate("keyup","."+this._triggerNodeClassName,this._DELEGATE.keyup,this),g.delegate("keydown","."+this._triggerNodeClassName,this._DELEGATE.keydown,this),g.delegate("click","."+this._triggerNodeIcon,this._DELEGATE.iconClick,this),g.delegate("click","."+this._triggerNodeClassName,this._DELEGATE.triggerNodeClick,this),u.on("resize",this._setPos,this),this)},syncUI:function(){!this.get("container")&&this.get("triggerNode")&&this._inputWrap()},render:function(){return this._dateBox.html(this._dateHTML()),this._setWidth()._setDateStyle()._setBtnStates(),this.fire("render"),this},nextMonth:function(){return this.set("date",i.DATE.siblingsMonth(this.get("date"),1)),this.render(),this.fire("nextmonth"),this},prevMonth:function(){return this.set("date",i.DATE.siblingsMonth(this.get("date"),-1)),this.render(),this.fire("prevmonth"),this},show:function(){return g.on("click",this._clickoutside,this),this.boundingBox.show(),this._setDefaultDate().render(),this.fire("show",{node:this.currentNode}),this},hide:function(){return g.detach("click",this._clickoutside,this),this.boundingBox.hide(),this.hideMessage(),this.currentNode&&(this.currentNode.getDOMNode()._selected=null),this._cacheNode=null,this._hide=!0,this.fire("hide",{node:this.currentNode}),this},showMessage:function(){return function(e){e.fire("showmessage"),setTimeout(function(){e._messageBox.addClass("visible")},5)}(this),this},hideMessage:function(){return this._messageBox.removeClass("visible"),this.fire("hidemessage"),this},getSelectedDate:function(){return this.get("selectedDate")},getCurrentNode:function(){return this.currentNode},getDateInfo:function(e){var t=-1,s=i.DATE.stringify(new Date),a=["今天","明天","后天"];switch(!0){case e==s:t=0;break;case e==i.DATE.siblings(s,1):t=1;break;case e==i.DATE.siblings(s,2):t=2}return!this._dateMap&&this.get("isHoliday")&&(this._dateMap=this._createDateMap()),this._dateMap&&this._dateMap[e]||a[t]||i.DATE.week(e)},_getDateStatus:function(e){return this.get("minDate")&&i.DATE.parse(e)<i.DATE.parse(this.get("minDate"))||this.get("maxDate")&&i.DATE.parse(e)>i.DATE.parse(this.get("maxDate"))},_getHolidaysClass:function(t,s){var a=i.HOLIDAYS;switch(!0){case s:case!this.get("isHoliday"):return"";case t==i.DATE.stringify(new Date):return"today";case!0:for(var n in a)if(e.inArray(t,a[n]))return n;default:return""}},_getAttrNode:function(t,s,i){var a=null;return n(t,function(t){return e.one(t).attr(s)===i?a=e.one(t):void 0}),a},_setWidth:function(){return function(e,t,s){return t.all(".inner, h4").css("width",t.one("table").outerWidth()),t.css("width",t.one(".inner").outerWidth()*e.get("count")+parseInt(s.css("borderLeftWidth"))+parseInt(s.css("borderRightWidth"))+parseInt(s.css("paddingLeft"))+parseInt(s.css("paddingRight"))),6!==o?this:(t.one("iframe").css({width:t.outerWidth(),height:t.outerHeight()}),void 0)}(this,this.boundingBox,this._contentBox),this},_setValue:function(t){if(this.set("selectedDate",t),this.get("container"))return this;switch(this._isInput(this.currentNode)&&this.currentNode.val(t),!0){case this.boundingBox.hasClass("calendar-bounding-box-style"):this.set("endDate",t);break;case!this.boundingBox.hasClass("calendar-bounding-box-style")&&!!this.get("finalTriggerNode"):this.set("startDate",t);var s=e.one(this.get("finalTriggerNode"));s&&this.get("isAutoSwitch")&&s.getDOMNode().select();break;default:this.set("selectedDate",t)}return this},_setDateInfo:function(e){return!this.get("container")&&this.get("isDateInfo")&&this._isInput(this.currentNode)?(this.currentNode.prev().html(h.test(e)?this.getDateInfo(e):""),this):this},_setDefaultValue:function(){var e=a(this.get("triggerNode")).item(0),t=a(this.get("finalTriggerNode")).item(0),s=e&&e.val(),i=t&&t.val();return s&&h.test(s)&&(this.get("isDateInfo")&&e.prev().html(this.getDateInfo(s)),this.set("startDate",s)),i&&h.test(i)&&(this.get("isDateInfo")&&t.prev().html(this.getDateInfo(i)),this.set("endDate",i)),this},_setDefaultDate:function(){return this.get("container")?this:(this.get("startDate")&&(this.set("minDate",this.boundingBox.hasClass("calendar-bounding-box-style")?this.get("startDate"):this._minDateCache),this.render()),this.boundingBox.hasClass("calendar-bounding-box-style")&&i.DATE.parse(this.get("startDate"))>i.DATE.parse(this.get("endDate"))?(this.set("date",this.get("startDate")||this.get("date")),this):(this.set("date",this.currentNode.val()||this.get("date")),this))},_setDateStyle:function(){var e=this.boundingBox,t=this.get("startDate"),s=this.get("endDate"),a=this.get("selectedDate"),n=i.DATE.differ(t,s),r=e.all("td"),o=null,d=t&&this._getAttrNode(r,"data-date",t),h=s&&this._getAttrNode(r,"data-date",s),l=a&&this._getAttrNode(r,"data-date",a);if(r.removeClass("start-date").removeClass("end-date").removeClass("selected-range").removeClass("selected-date"),d&&d.addClass("start-date"),h&&h.addClass("end-date"),l&&l.addClass("selected-date"),!t||!s||i.DATE.parse(t)>i.DATE.parse(s))return this;for(var u=0;n-1>u;u++)t=i.DATE.siblings(t,1),o=this._getAttrNode(r,"data-date",t),o&&o.addClass("selected-range");return this},_setBtnStates:function(){var e=+i.DATE.siblingsMonth(this.get("date"),0),t=this.get("maxDate"),s=this.get("minDate"),a=this.boundingBox.one(".prev-btn"),n=this.boundingBox.one(".next-btn"),r=this.boundingBox.one(".close-btn");return s&&(s=+i.DATE.parse(s)),t&&(t=+i.DATE.siblingsMonth(i.DATE.parse(t),1-this.get("count"))),(s||Number.MIN_VALUE)>=e?a.addClass("prev-btn-disabled"):a.removeClass("prev-btn-disabled"),e>=(t||Number.MAX_VALUE)?n.addClass("next-btn-disabled"):n.removeClass("next-btn-disabled"),this.get("container")&&r.hide(),this},_setMessage:function(){return this._messageBox.html(this.get("message")),this},_setUniqueTag:function(){return function(e,t){e._calendarId="calendar-"+t,e._delegateClickClassName="delegate-click-"+t,e._delegateChangeClassName="delegate-change-"+t,e._triggerNodeIcon="trigger-icon-"+t,e._triggerNodeClassName="trigger-node-"+t}(this,e.guid()),this},_setPos:function(){return function(e,t){t&&setTimeout(function(){var s=t.offset().left,i=t.offset().top+t.outerHeight(),a=e.boundingBox.outerWidth(),n=e.boundingBox.outerHeight(),r=t.outerWidth(),o=t.outerHeight(),d=g.width()-a,h=g.height()-n;(function(e,t){i>h&&(i=0>e?i:e),s>d&&(s=0>t?s:t)})(i-n-o,s+r-a),e.boundingBox.css({top:i,left:s})},10)}(this,this.currentNode),this},_inputWrap:function(){return function(e,t,s){t.each(function(t){if((e.get("isDateInfo")||e.get("isDateIcon"))&&e._isInput(t)&&!t.parent(".calendar-input-wrap")){var s=a(i.INPUT_WRAP_TEMPLATE);t.after(s),s.append(r(i.START_DATE_TEMPLATE,{delegate_icon:e._triggerNodeIcon})).append(t),e.get("isDateIcon")||t.prev().removeClass("calendar-start-icon")}t.addClass(e._triggerNodeClassName),e._isInput(t)&&t.attr("autocomplete","off")}),s.each(function(t){if((e.get("isDateInfo")||e.get("isDateIcon"))&&e._isInput(t)&&!t.parent(".calendar-input-wrap")){var s=a(i.INPUT_WRAP_TEMPLATE);t.after(s),s.append(r(i.END_DATE_TEMPLATE,{delegate_icon:e._triggerNodeIcon})).append(t),e.get("isDateIcon")||t.prev().removeClass("calendar-end-icon")}t.addClass(e._triggerNodeClassName),e._isInput(t)&&t.attr("autocomplete","off")})}(this,a(this.get("triggerNode")),a(this.get("finalTriggerNode"))),this},_fixSelectMask:function(){return 6===o&&this.boundingBox.append("<iframe />"),this},_mouseenter:function(e){var t=this.boundingBox,s=this.get("startDate"),a=e.attr("data-date"),n=i.DATE.differ(s,a),r=(t.all("td"),null);if(clearTimeout(this.leaveTimer),t.all("td").removeClass("hover"),i.DATE.parse(s)>i.DATE.parse(a))return this;for(var o=0;n-1>o;o++)s=i.DATE.siblings(s,1),r=t.one('td[data-date="'+s+'"]'),r&&r.addClass("hover")},_mouseleave:function(){(function(e){clearTimeout(e.leaveTimer),e.leaveTimer=setTimeout(function(){e.boundingBox.all("td").removeClass("hover")},30)})(this)},_DELEGATE:{click:function(t){t.preventDefault();var s=e.one(t.currentTarget),i=s.attr("data-date");switch(!0){case s.hasClass("prev-btn")&&!s.hasClass("prev-btn-disabled"):this.prevMonth();break;case s.hasClass("next-btn")&&!s.hasClass("next-btn-disabled"):this.nextMonth();break;case s.hasClass("close-btn"):this.hide();break;case s&&s.hasClass(this._delegateClickClassName)&&this.boundingBox.hasClass("calendar-bounding-box-style")&&i==this.get("minDate"):break;case!!i&&!s.hasClass("disabled"):this.get("container")||this.hide(),this._setValue(i)._setDateInfo(i)._setDateStyle().fire("dateclick",{date:i,dateInfo:this.getDateInfo(i)})}},change:function(){var e=this.boundingBox.all("."+this._delegateChangeClassName);this.set("date",e.item(0).val()+"-"+e.item(1).val()+"-01"),this.render(),function(e){e._hide=!1,setTimeout(function(){e._hide=!0},0)}(this)},mouse:function(t){var s=e.one(t.currentTarget).parent("td");if(!s.hasClass("disabled"))switch(t.type){case"mouseenter":this.boundingBox.hasClass("calendar-bounding-box-style")&&!!this.get("startDate")&&this._mouseenter(s);break;case"mouseleave":this._mouseleave()}},focusin:function(t){var s=this.currentNode=e.one(t.currentTarget);this.boundingBox[this._inNodeList(s,a(this.get("triggerNode")))?"removeClass":"addClass"]("calendar-bounding-box-style"),this.hideMessage(),this._cacheNode&&this._cacheNode.getDOMNode()!=s.getDOMNode()&&this.hide(),"none"==this.boundingBox.css("display")&&this.show()._setWidth()._setPos(),this._cacheNode=s},keyup:function(t){if(this.get("isKeyup")){clearTimeout(this.keyupTimer);var s=this,a=e.one(t.currentTarget);if(this._isInput(a)){var n=a.val();s._setDateInfo(n),h.test(n)&&(this.keyupTimer=setTimeout(function(){n=i.DATE.stringify(i.DATE.parse(n)),s._setValue(n),s.set("date",n),s.render()},200))}}},keydown:function(e){9==e.keyCode&&this.hide()},iconClick:function(t){var s=e.one(t.target).parent(".calendar-input-wrap").one("."+this._triggerNodeClassName),i=s?s.getDOMNode():null,a=this.currentNode?this.currentNode.getDOMNode():null;(i!=a||"none"==this.boundingBox.css("display"))&&i.focus()},triggerNodeClick:function(t){var s=t.target;!s._selected&&this._isInput(e.one(s))&&(s.select(),s._selected=!0)}},_maxCell:function(){for(var e=this.get("date"),t=e.getFullYear(),s=e.getMonth()+1,i=[],a=0;this.get("count")>a;a++)i.push(new Date(t,s-1+a,1).getDay()+new Date(t,s+a,0).getDate());return Math.max.apply(null,i)},_isInput:function(e){return"INPUT"===e.getDOMNode().tagName.toUpperCase()&&("text"===e.attr("type")||"date"===e.attr("type"))},_inNodeList:function(e,t){var s=!1;return n(t,function(t){e.equals(t)&&(s=!0)}),s},_createSelect:function(){var e=this.get("date"),t=this.get("minDate"),s=this.get("maxDate"),a=e.getFullYear(),n=i.DATE.filled(e.getMonth()+1),o=t&&t.substr(0,4)||1900,d=s&&s.substr(0,4)||(new Date).getFullYear()+3,h=t&&t.substr(5,2)||1,l=s&&s.substr(5,2)||12,u=' selected="selected"',g={};g.delegate_change=this._delegateChangeClassName,g.year_template="",g.month_template="",a==o||a==d||(h=1,l=12);for(var c=d;c>=o;c--)g.year_template+="<option"+(a==c?u:"")+' value="'+c+'">'+c+"</option>";for(var c=h;l>=c;c++)g.month_template+="<option"+(n==c?u:"")+' value="'+i.DATE.filled(c)+'">'+i.DATE.filled(c)+"</option>";return r(i.SELECT_TEMPLATE,g)},_createDateMap:function(){var e={};for(var t in i.HOLIDAYS)for(var s=i.HOLIDAYS[t],a=0;s.length>a;a++)for(var n=s[a],r=i.DATENAME[t],o=0;7>o;o++){var d=i.DATE.siblings(n,o-3);(function(t,s){e[d]=e[d]?t>2?s:e[d]:s})(o,r+(3!=o?(3>o?"前":"后")+Math.abs(o-3)+"天":""))}return e},_initCalendarHTML:function(){var e={};return e.delegate_click=this._delegateClickClassName,e.bounding_box_id=this._calendarId,e.message_template=this.get("message"),e.date_template=this._dateHTML(),r(i.CALENDAR_TEMPLATE,e)},_dateHTML:function(e){for(var e=this.get("date"),t=e.getFullYear(),s=e.getMonth(),a="",n=0;this.get("count")>n;n++)a+=r(i.DATE_TEMPLATE,this._singleDateHTML(new Date(t,s+n)));return a},_singleDateHTML:function(e){var t=e.getFullYear(),s=e.getMonth()+1,a=new Date(t,s-1,1).getDay(),o=new Date(t,s,0).getDate(),d=[{wd:"日",weekend:"weekend"},{wd:"一"},{wd:"二"},{wd:"三"},{wd:"四"},{wd:"五"},{wd:"六",weekend:"weekend"}],h="";n(d,function(e){h+=r(i.HEAD_TEMPLATE,{weekday_name:e.wd,weekend:e.weekend||""})});for(var l="",u=[];a--;)u.push(0);for(var g=1;o>=g;g++)u.push(g);u.length=this._maxCell();var c=Math.ceil(u.length/7);this.get("data");for(var g=0;c>g;g++){for(var _="",f=0;6>=f;f++){var D=u[f+7*g]||"",e=D?t+"-"+i.DATE.filled(s)+"-"+i.DATE.filled(D):"";_+=r(i.DAY_TEMPLATE,{day:D,date:e,disabled:this._getDateStatus(e)||!D?"disabled":this._delegateClickClassName,date_class:this._getHolidaysClass(e,this._getDateStatus(e)||!D)})}l+=r(i.BODY_TEMPLATE,{calday_row:_})}var p={};p.head_template=h,p.body_template=l;var T={};return T.date=this.get("isSelect")?this._createSelect():t+"年"+s+"月",T.table_template=r(i.TABLE_TEMPLATE,p),T}},{DATE:{parse:function(e){return e=e.match(d),e?new Date(e[0],e[1]-1,e[2]):null},stringify:function(t){return e.isDate(t)?t.getFullYear()+"-"+this.filled(1*t.getMonth()+1)+"-"+this.filled(t.getDate()):null},siblings:function(e,t){return e=e.match(d),this.stringify(new Date(e[0],e[1]-1,1*e[2]+1*t))},siblingsMonth:function(e,t){return new Date(e.getFullYear(),1*e.getMonth()+t)},filled:function(e){return(e+"").replace(/^(\d)$/,"0$1")},differ:function(e,t){return parseInt(Math.abs(this.parse(e)-this.parse(t))/24/60/60/1e3)},isDate:function(e){if(!h.test(e))return!1;var t=this.parse(e);return 1*t.getMonth()+1==e.match(d)[1]},week:function(e){return"星期"+["日","一","二","三","四","五","六"][i.DATE.parse(e).getDay()]}},CALENDAR_TEMPLATE:'<div id="{bounding_box_id}" class="calendar-bounding-box"><div class="calendar-container"><div class="message-box">{message_template}</div><div class="content-box"><div class="arrow"><span class="close-btn {delegate_click}" title="关闭">close</span><span class="prev-btn {delegate_click}" title="上月">prev</span><span class="next-btn {delegate_click}" title="下月">next</span></div><div class="date-box">{date_template}</div></div></div></div>',DATE_TEMPLATE:'<div class="inner"><h4>{date}</h4>{table_template}</div>',SELECT_TEMPLATE:'<select class="{delegate_change}">{year_template}</select>年<select class="{delegate_change}">{month_template}</select>月',TABLE_TEMPLATE:"<table><thead><tr>{head_template}</tr></thead><tbody>{body_template}</tbody></table>",HEAD_TEMPLATE:'<th class="{weekend}">{weekday_name}</th>',BODY_TEMPLATE:"<tr>{calday_row}</tr>",DAY_TEMPLATE:'<td data-date="{date}" class="{disabled}"><a href="javascript:;" class="{date_class}">{day}</a></td>',INPUT_WRAP_TEMPLATE:'<div class="calendar-input-wrap" />',START_DATE_TEMPLATE:'<span class="calendar-start-icon {delegate_icon}" />',END_DATE_TEMPLATE:'<span class="calendar-end-icon {delegate_icon}" />',DATENAME:{today:"今天",yuandan:"元旦",chuxi:"除夕",chunjie:"春节",yuanxiao:"元宵节",qingming:"清明",wuyi:"劳动节",duanwu:"端午节",zhongqiu:"中秋节",guoqing:"国庆节"},HOLIDAYS:{yuandan:["2012-01-01","2013-01-01","2014-01-01","2015-01-01","2016-01-01","2017-01-01","2018-01-01","2019-01-01","2020-01-01"],chuxi:["2012-01-22","2013-02-09","2014-01-30","2015-02-18","2016-02-07","2017-01-27","2018-02-15","2019-02-04","2020-01-24"],chunjie:["2012-01-23","2013-02-10","2014-01-31","2015-02-19","2016-02-08","2017-01-28","2018-02-16","2019-02-05","2020-01-25"],yuanxiao:["2012-02-06","2013-02-24","2014-02-14","2015-03-05","2016-02-22","2017-02-11","2018-03-02","2019-02-19","2020-02-08"],qingming:["2012-04-04","2013-04-04","2014-04-05","2015-04-05","2016-04-04","2017-04-04","2018-04-05","2019-04-05","2020-04-04"],wuyi:["2012-05-01","2013-05-01","2014-05-01","2015-05-01","2016-05-01","2017-05-01","2018-05-01","2019-05-01","2020-05-01"],duanwu:["2012-06-23","2013-06-12","2014-06-02","2015-06-20","2016-06-09","2017-05-30","2018-06-18","2019-06-07","2020-06-25"],zhongqiu:["2012-09-30","2013-09-19","2014-09-08","2015-09-27","2016-09-15","2017-10-04","2018-09-24","2019-09-13","2020-10-01"],guoqing:["2012-10-01","2013-10-01","2014-10-01","2015-10-01","2016-10-01","2017-10-01","2018-10-01","2019-10-01","2020-10-01"]},NAME:"TripCalendar",ATTRS:{boundingBox:{readOnly:!0},date:{value:new Date,setter:function(t){return e.isDate(t)||(t=h.test(t)?t:new Date),t},getter:function(t){return e.isDate(t)?t:e.isString(t)?(t=t.match(d),new Date(t[0],t[1]-1)):void 0}},count:{value:2,getter:function(e){return this.get("isSelect")&&(e=1),e}},selectedDate:{value:null,setter:function(t){return e.isDate(t)&&(t=i.DATE.stringify(t)),h.test(t)?t:null},getter:function(t){return e.isString(t)&&(t=i.DATE.stringify(i.DATE.parse(t))),t||""}},minDate:{value:null,setter:function(t){return e.isDate(t)&&(t=i.DATE.stringify(t)),h.test(t)?t:null},getter:function(t){return e.isString(t)&&(t=i.DATE.stringify(i.DATE.parse(t))),t||""}},maxDate:{value:null,setter:function(t){return e.isDate(t)&&(t=i.DATE.stringify(t)),h.test(t)?t:null},getter:function(t){return e.isString(t)&&(t=i.DATE.stringify(i.DATE.parse(t))),t||""}},startDate:{value:""},endDate:{value:""},afterDays:{value:0,setter:function(e){return e>0&&this.set("maxDate",i.DATE.siblings(this.get("minDate")||i.DATE.stringify(new Date),e)),e},getter:function(e){return e&&(this.get("minDate")||this.set("minDate",new Date)),e}},message:{value:""},triggerNode:{value:"",getter:function(e){return/\,/.test(e)&&(e=e.replace(/\s+/g,""),e=e.split(RegExp("\\s+"+e+"+\\s","g")),e=e.join().replace(/^,+|,+$/g,"")),e}},finalTriggerNode:{value:"",getter:function(e){return/\,/.test(e)&&(e=e.replace(/\s+/g,""),e=e.split(RegExp("\\s+"+e+"+\\s","g")),e=e.join().replace(/^,+|,+$/g,"")),e}},container:{value:null,getter:function(e){return/\,/.test(e)&&(e=e.replace(/\s+/g,""),e=e.split(RegExp("\\s+"+e+"+\\s","g")),e=e.join().replace(/^,+|,+$/g,"")),e}},isSelect:{value:!1},isKeyup:{value:!0},isDateInfo:{value:!0},isDateIcon:{value:!0},isHoliday:{value:!0,setter:function(e){return e||(this._dateMap=null),e}},isAutoSwitch:{value:!1}}})},{requires:["node","base","sizzle","./assets/index.css"]});